<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 1200">
    <!-- Background -->
    <rect width="1200" height="1200" fill="#ffffff"/>
    
    <!-- Title -->
    <text x="600" y="50" font-family="Arial" font-size="26" text-anchor="middle" font-weight="bold">Rectangle ROI Selector: Process Flow</text>
    
    <!-- Initialize Section -->
    <rect x="450" y="80" width="300" height="60" rx="10" fill="#E6F2FF" stroke="#0066CC" stroke-width="2"/>
    <text x="600" y="117" font-family="Arial" font-size="16" text-anchor="middle" font-weight="bold">Initialize Application</text>
    
    <!-- Capture Frame -->
    <rect x="450" y="160" width="300" height="60" rx="10" fill="#E6F2FF" stroke="#0066CC" stroke-width="2"/>
    <text x="600" y="197" font-family="Arial" font-size="16" text-anchor="middle">Capture Camera Frame</text>
    
    <!-- Display Initial Frame -->
    <rect x="450" y="240" width="300" height="60" rx="10" fill="#E6F2FF" stroke="#0066CC" stroke-width="2"/>
    <text x="600" y="277" font-family="Arial" font-size="16" text-anchor="middle">Display Initial Frame</text>
    
    <!-- Create ROI Selector -->
    <rect x="450" y="320" width="300" height="60" rx="10" fill="#E6F2FF" stroke="#0066CC" stroke-width="2"/>
    <text x="600" y="357" font-family="Arial" font-size="16" text-anchor="middle">Create RectangleROISelector</text>
    
    <!-- User Interaction Loop -->
    <rect x="50" y="420" width="1100" height="450" rx="10" fill="#FFFCE6" stroke="#CC9900" stroke-width="2" stroke-dasharray="5,5"/>
    <text x="600" y="445" font-family="Arial" font-size="20" text-anchor="middle" font-weight="bold">User Interaction Loop</text>
    
    <!-- Mouse Events Branch -->
    <path d="M 600 380 L 600 420" stroke="#000000" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
    
    <!-- Point Selection Loop Box -->
    <rect x="100" y="480" width="450" height="360" rx="10" fill="#F2FFF2" stroke="#009900" stroke-width="2"/>
    <text x="325" y="510" font-family="Arial" font-size="18" text-anchor="middle" font-weight="bold">Point Selection Process</text>
    
    <!-- First Point -->
    <rect x="150" y="530" width="150" height="50" rx="10" fill="#FFFFFF" stroke="#009900" stroke-width="2"/>
    <text x="225" y="560" font-family="Arial" font-size="14" text-anchor="middle">Select Point 1</text>
    
    <!-- Second Point -->
    <rect x="150" y="600" width="150" height="50" rx="10" fill="#FFFFFF" stroke="#009900" stroke-width="2"/>
    <text x="225" y="630" font-family="Arial" font-size="14" text-anchor="middle">Select Point 2</text>
    
    <!-- Third Point -->
    <rect x="150" y="670" width="150" height="50" rx="10" fill="#FFFFFF" stroke="#009900" stroke-width="2"/>
    <text x="225" y="700" font-family="Arial" font-size="14" text-anchor="middle">Select Point 3</text>
    
    <!-- Fourth Point (Auto) -->
    <rect x="150" y="740" width="350" height="50" rx="10" fill="#FFFFFF" stroke="#009900" stroke-width="2"/>
    <text x="325" y="770" font-family="Arial" font-size="14" text-anchor="middle">Point 4 Calculated Automatically</text>
    
    <!-- Point Selection Arrows -->
    <path d="M 225 580 L 225 600" stroke="#000000" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
    <path d="M 225 650 L 225 670" stroke="#000000" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
    <path d="M 225 720 L 225 740" stroke="#000000" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
    
    <!-- Point 3 Calculation Box -->
    <rect x="350" y="640" width="170" height="100" rx="10" fill="#FFF0F0" stroke="#CC0000" stroke-width="2" stroke-dasharray="5,5"/>
    <text x="435" y="665" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">Perpendicular Constraint</text>
    <text x="435" y="685" font-family="Arial" font-size="10" text-anchor="middle">1. Calculate vectors</text>
    <text x="435" y="705" font-family="Arial" font-size="10" text-anchor="middle">2. Find perpendicular component</text>
    <text x="435" y="725" font-family="Arial" font-size="10" text-anchor="middle">3. Enforce 90Â° angle</text>
    
    <!-- Constaint Arrow -->
    <path d="M 300 680 L 350 680" stroke="#CC0000" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
    
    <!-- ROI Preview Box -->
    <rect x="650" y="480" width="450" height="200" rx="10" fill="#F2F2FF" stroke="#0000CC" stroke-width="2"/>
    <text x="875" y="510" font-family="Arial" font-size="18" text-anchor="middle" font-weight="bold">Real-time Preview Features</text>
    
    <!-- Preview Features -->
    <rect x="700" y="530" width="350" height="40" rx="5" fill="#FFFFFF" stroke="#0000CC" stroke-width="2"/>
    <text x="875" y="555" font-family="Arial" font-size="14" text-anchor="middle">Line from Point 1 to Mouse (when selecting Point 2)</text>
    
    <rect x="700" y="580" width="350" height="40" rx="5" fill="#FFFFFF" stroke="#0000CC" stroke-width="2"/>
    <text x="875" y="605" font-family="Arial" font-size="14" text-anchor="middle">Rectangle Preview (when selecting Point 3)</text>
    
    <rect x="700" y="630" width="350" height="40" rx="5" fill="#FFFFFF" stroke="#0000CC" stroke-width="2"/>
    <text x="875" y="655" font-family="Arial" font-size="14" text-anchor="middle">Contextual Instructions Text</text>
    
    <!-- Keyboard Events Box -->
    <rect x="650" y="700" width="450" height="140" rx="10" fill="#FFF2FF" stroke="#990099" stroke-width="2"/>
    <text x="875" y="730" font-family="Arial" font-size="18" text-anchor="middle" font-weight="bold">Keyboard Controls</text>
    
    <!-- Keyboard Controls -->
    <rect x="700" y="750" width="350" height="40" rx="5" fill="#FFFFFF" stroke="#990099" stroke-width="2"/>
    <text x="875" y="775" font-family="Arial" font-size="14" text-anchor="middle">ENTER: Confirm Selection & Extract ROI</text>
    
    <rect x="700" y="800" width="350" height="30" rx="5" fill="#FFFFFF" stroke="#990099" stroke-width="2"/>
    <text x="875" y="820" font-family="Arial" font-size="14" text-anchor="middle">ESC: Exit Application</text>
    
    <!-- Result Processing Section -->
    <rect x="50" y="890" width="1100" height="280" rx="10" fill="#F7F7F7" stroke="#666666" stroke-width="2"/>
    <text x="600" y="925" font-family="Arial" font-size="20" text-anchor="middle" font-weight="bold">ROI Processing</text>
    
    <!-- Extract ROI Process -->
    <rect x="100" y="960" width="400" height="180" rx="10" fill="#E6FFF2" stroke="#00994C" stroke-width="2"/>
    <text x="300" y="990" font-family="Arial" font-size="18" text-anchor="middle" font-weight="bold">ROI Extraction Process</text>
    
    <!-- Extract ROI Steps -->
    <rect x="150" y="1010" width="300" height="40" rx="5" fill="#FFFFFF" stroke="#00994C" stroke-width="2"/>
    <text x="300" y="1035" font-family="Arial" font-size="14" text-anchor="middle">1. Create Perspective Transform</text>
    
    <rect x="150" y="1060" width="300" height="40" rx="5" fill="#FFFFFF" stroke="#00994C" stroke-width="2"/>
    <text x="300" y="1085" font-family="Arial" font-size="14" text-anchor="middle">2. Warp Image to Rectangle</text>
    
    <rect x="150" y="1110" width="300" height="40" rx="5" fill="#FFFFFF" stroke="#00994C" stroke-width="2"/>
    <text x="300" y="1135" font-family="Arial" font-size="14" text-anchor="middle">3. Apply 16:9 Aspect Ratio Padding</text>
    
    <!-- Final Display -->
    <rect x="700" y="960" width="350" height="180" rx="10" fill="#FFE6E6" stroke="#CC0000" stroke-width="2"/>
    <text x="875" y="990" font-family="Arial" font-size="18" text-anchor="middle" font-weight="bold">Final Results</text>
    
    <rect x="750" y="1025" width="250" height="50" rx="5" fill="#FFFFFF" stroke="#CC0000" stroke-width="2"/>
    <text x="875" y="1050" font-family="Arial" font-size="14" text-anchor="middle">Display Extracted ROI</text>
    
    <rect x="750" y="1085" width="250" height="30" rx="5" fill="#FFFFFF" stroke="#CC0000" stroke-width="2"/>
    <text x="875" y="1105" font-family="Arial" font-size="14" text-anchor="middle">Return ROI Points & Image</text>
    
    <!-- Arrows from Interaction to Processing -->
    <path d="M 600 870 L 600 890" stroke="#000000" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
    
    <!-- Extract to Display Arrow -->
    <path d="M 500 1050 L 700 1050" stroke="#000000" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
    
    <!-- Arrow marker definition -->
    <defs>
        <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
            <path d="M0,0 L0,6 L9,3 z" fill="#000000" />
        </marker>
    </defs>
    
    <!-- Right-Click Reset Feature -->
    <rect x="100" y="850" width="180" height="30" rx="5" fill="#FFCCCC" stroke="#CC0000" stroke-width="2"/>
    <text x="190" y="870" font-family="Arial" font-size="12" text-anchor="middle">Right-Click: Reset Selection</text>
    <path d="M 120 849 L 100 820 L 80 840" stroke="#CC0000" stroke-width="2" fill="none"/>
    
</svg>
